<script src="https://cdnjs.cloudflare.com/ajax/libs/multi-select/0.9.12/js/jquery.multi-select.min.js" type="text/javascript"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.12.0/jquery.validate.min.js"></script>
<link rel="stylesheet" href="https://foundation.uc.edu/file/redesign/css/tinymce_styles.css" type="text/css" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/multi-select/0.9.12/css/multi-select.min.css" />
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" />
<link rel="stylesheet" href="/client/styles/Admin/GenericUI.css" type="text/css" />

<link rel="stylesheet" href="https://foundation.uc.edu/file/custom-content-parts/css/bb-custom-form_editor.css" type="text/css" />
<link href='https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/themes/ui-lightness/jquery-ui.css' rel='stylesheet'>

<style>
  	.ui-state-highlight { 
    	height: 200px; 
  	}
  
    .ui-datepicker td {
        border: 0;
        padding: 1px !important;
    }
  
  	.tip {
    	background-color: #0dcaf0 !important;
    	margin-bottom: 0.5em;
    	padding: 10px;
	}
  
  	.ui-widget-header {
    	border: 1px solid #ddd;
    	background: #e9e9e9 !important;
    	color: #333 !important;
    	font-weight: bold;
  	}
  
</style>
<div id="BBTabs">

    <ul>
        <li><a href="#tab-1">Content</a></li>
    </ul>

    <!-- FIELDS -->
    <div id="tab-1" class="StepGrouping">
        <h1 class="StepGroupingHeading">
            Content
        </h1>
        <div class="StepGroupingBody">

            <div class="HelpText">
                Add, update, remove, and re-order your content.
            </div>


            <div class="VerticalOption">
                <div class="ItemContainer">

                    <div class="ItemTable" cellspacing="0" cellpadding="0">
                        <div class="ItemRow" id="ItemRowTemplate">
                            <input type="hidden" id="ItemIndex_0" name="ItemIndex_0" />

                            <div class="Center">

                                <div class="ItemHeader">

                                    <div class="Counter">
                                        <span>0</span>
                                    </div>
                                    <div class="FieldType">
                                    </div>

                                    <div class="ItemActions" id="DivItemActions_0">
                                        <a class="ItemActionMove">
                                            <i class="fa fa-arrows-v"></i>
                                        </a>
                                        <a class="ItemActionDelete">
                                            <i class="fa fa-trash"></i>
                                        </a>
                                    </div>

                                </div>

                                <div class="top">
                                    <div class="Question" id="DivQuestion_0">
                                        <div class="tip"><em>Tip: Text displays based on font assignment.</em></div>
                                        <label>Content: <input class="form-control required" type="text"
												name="Question_0" id="Question_0" /></label>
                                    </div>
                                  
                                  	<div class="Video" id="DivVideo_0">
                                        <div class="tip"><em>Tip: Copy YouTube URL into text field. Leave Link Text field blank to show video embedded on web page. Link text will appear as link button that opens video in modal.</em></div>
                                        <label>YouTube URL: <input class="form-control required videoUrl" type="text"
												name="Video_0" id="Video_0" /></label>
                                      
                                      	<label>Link Text: <input class="form-control required
												linkText" type="text" name="linkText_0" id="linkText_0" /></label>
                                    </div>

                                    <div class="Blockquote" id="DivBlockquote_0">
                                        <div class="tip"><em>Tip: Quote text wrapped inside quotations so no need to wrap.
												Dash in front of source is automatically added.</em></div>
                                      
                                      	<div class="FieldContent">
                                            <label>Quote Text: </label>
                                      		<textarea class="required quoteText tinymce" id="Blockquote_0" name="Blockquote_0" cols="80"></textarea>
                                        </div>
                                      
                                        <label>Quote Source: <input class="form-control quoteSource"
												type="text"
												name="QuoteSource_0" id="QuoteSource_0" /></label>
                                    </div>

                                    <div class="ButtonLink" id="DivButtonLink_0">
                                      	<div class="tip"><em>Tip: Button Link allows you to enter button text and assign destination link.</em></div>
                                      
                                        <label>Button Link Text: <input class="form-control required
												linkText"
												type="text"
												name="linkText_0" id="linkText_0" /></label>
                                        <hr>
                                        <div class="Field">
                                            <p>
                                                <label>Selected Link Name:</label>
                                                <span class="selected-link-name"></span>
                                            </p>
                                            <p>
                                                <label>Selected Link URL:</label>
                                                <span class="selected-link-url"></span>
                                            </p>
                                            <p>
                                                <button class="btn-select" name="btn-select_0" id="btn-select_0">Select
													Link</button>
                                            </p>
                                        </div>
                                    </div>

                                    <div class="Byline" id="DivByline_0">
                                      	<div class="tip"><em>Tip: Byline allows you to display author information.</em></div>
                                      
                                        <label>Author Name: <input class="form-control required authorName"
												type="text"
												name="AuthorName_0" id="AuthorName_0" /></label>
                                        <label>Author Email: <input class="form-control authorEmail"
												type="text"
												name="AuthorEmail_0" id="AuthorEmail_0" /></label>
                                        <label>Date Published: <input class="form-control datePublished"
												type="text"
												name="DatePublished_0" id="DatePublished_0" /></label>
                                        <hr>
                                        <div class="Field">
                                            <p>
                                                <label>Selected Link Name:</label>
                                                <span class="selected-link-name"></span>
                                            </p>
                                            <p>
                                                <label>Selected Link URL:</label>
                                                <span class="selected-link-url"></span>
                                            </p>
                                            <p>
                                                <button class="btn-select" name="btn-select_0" id="btn-select_0">Select
													Link</button>
                                            </p>
                                        </div>
                                    </div>

                                    <div class="CalloutBox" id="DivCalloutBox_0">
                                        <div class="tip"><em>Tip: Text displays at a max-width of 1024 pixels and has a
												gray background.</em></div>
                                      
                                        <div class="FieldContent">
                                            <label>Custom Call-Out Box Content: </label>
                                            <textarea class="tinymce" id="CalloutBox_0" name="CalloutBox_0" cols="80"></textarea>
                                        </div>
                                    </div>

                                    <div class="Card" id="DivCardTitle_0">
                                      	<div class="tip"><em>Tip: Card displays stacked in the following order: Image, Heading, Plain Text, Link.</em></div>
                                      
                                        <label>Card Title: <input class="form-control required cardTitle"
												type="text"
												name="CardTitle_0" id="CardTitle_0" /></label>
                                        <label>Card Text: <input class="form-control required cardText"
												type="text"
												name="CardText_0" id="CardText_0" /></label>
                                        <label>Card Link Text: <input class="form-control required
												cardLinkText"
												type="text"
												name="cardLinkText_0" id="cardLinkText_0" /></label>
                                        <hr>
                                        <div class="Field">
                                            <p>
                                                <label>Selected Link Name:</label>
                                                <span class="selected-link-name"></span>
                                            </p>
                                            <p>
                                                <label>Selected Link URL:</label>
                                                <span class="selected-link-url"></span>
                                            </p>
                                            <p>
                                                <button class="btn-select" name="btn-select_0" id="btn-select_0">Select
													Link</button>
                                            </p>
                                        </div>
                                        <hr>
                                        <div class="Field">
                                            <div class="FieldHeading">
                                                <label for="field-highlighter-image" class="FieldLabel">Image:</label>
                                                <span class="FieldRequired">*</span>
                                                <span class="clear"></span>
                                            </div>
                                            <div class="FieldContent">
                                                <div class="SearchFieldContainer">
                                                    <div class="SearchFieldBox">
                                                        <a href="#" class="SearchField ImagePicker" id="ImagePicker_0">
                                                            <span class="SearchFieldIcon">
																<img src="/images/pencil_16.gif" alt="" />
															</span>
                                                            <span class="SearchFieldText"></span>
                                                            <span class="SearchFieldButton">
																<img src="/images/Admin/Buttons/search.gif" alt="" />
															</span>
                                                        </a>
                                                    </div>

                                                </div>
                                            </div>
                                        </div>
                                        <div class="Field ImagePickerRender" name="ImagePickerRender_0" id="ImagePickerRender_0">
                                            <img src="">
                                        </div>
                                    </div>
                                  
									<div class="Formattedtext" id="DivFormattedtext_0">
                                      	<div class="tip"><em>Tip: Formatted Text allows you to add formatted text similar to how the 'Formatted Text and Image' BBIS part works. You can insert links and images the same way as the BBIS part.</em></div>
                                      
                                        <div class="FieldContent">
                                            <label>Formatted Content: </label>
                                            <textarea class="tinymce" id="Formattedtext_0" name="Formattedtext_0" cols="80"></textarea>
                                        </div>
                                    </div>

                                    <div class="HR" id="DivHr_0">
                                      	<div class="tip"><em>Tip: Skewed HR is cut off on left/right sides for column
											width greater than 11.</em></div>
                                    </div>

                                    <div class="Image" id="DivImage_0">
                                      	<div class="tip"><em>Tip: Image allows you to set the alignment as well as the width. Set 'Full Width of Page?' to 'Yes' to make image stretch across width of browser window.</em></div>
                                      
                                        <label for="ImageAlign_0">Image Alignment:
											<select id="ImageAlign_0" class="imageAlign">
												<option value="left">Left</option>
												<option value="center">Center</option>
												<option value="right">Right</option>
											</select></label>
                                        <label>Image Caption (centered under image): <input
												class="form-control required
												imageCaption"
												type="text" name="ImageCaption_0" id="ImageCaption_0" /></label>
                                        <hr>
                                        <div class="Field">
                                            <div class="FieldHeading">
                                                <label for="field-highlighter-image" class="FieldLabel">Image:</label>
                                                <span class="FieldRequired">*</span>
                                                <span class="clear"></span>
                                            </div>
                                            <div class="FieldContent">
                                                <div class="SearchFieldContainer">
                                                    <div class="SearchFieldBox">
                                                        <a href="#" class="SearchField ImagePicker" id="ImagePicker_0">
                                                            <span class="SearchFieldIcon">
																<img src="/images/pencil_16.gif" alt="" />
															</span>
                                                            <span class="SearchFieldText"></span>
                                                            <span class="SearchFieldButton">
																<img src="/images/Admin/Buttons/search.gif" alt="" />
															</span>
                                                        </a>
                                                    </div>

                                                </div>
                                            </div>
                                        </div>
                                        <div class="Field ImagePickerRender" name="ImagePickerRender_0" id="ImagePickerRender_0">
                                            <img src="">
                                        </div>
                                    </div>

                                    <div class="RelatedStory" id="DivRelatedStory_0">
                                      	<div class="tip"><em>Tip: Related Story displays stacked in the following order: Image, Title, Link.</em></div>
                                      
                                        <label>Title: <input class="form-control required relatedStoryTitle"
												type="text"
												name="RelatedStoryTitle_0" id="RelatedStoryTitle_0" /></label>
                                        <label>Link Text: <input class="form-control required
												relatedStoryLinkText"
												type="text"
												name="relatedStoryLinkText_0" id="relatedStoryLinkText_0" /></label>
                                        <hr>
                                        <div class="Field">
                                            <p>
                                                <label>Selected Link Name:</label>
                                                <span class="selected-link-name"></span>
                                            </p>
                                            <p>
                                                <label>Selected Link URL:</label>
                                                <span class="selected-link-url"></span>
                                            </p>
                                            <p>
                                                <button class="btn-select" name="btn-select_0" id="btn-select_0">Select
													Link</button>
                                            </p>
                                        </div>
                                        <hr>
                                        <div class="Field">
                                            <div class="FieldHeading">
                                                <label for="field-highlighter-image" class="FieldLabel">Image:</label>
                                                <span class="FieldRequired">*</span>
                                                <span class="clear"></span>
                                            </div>
                                            <div class="FieldContent">
                                                <div class="SearchFieldContainer">
                                                    <div class="SearchFieldBox">
                                                        <a href="#" class="SearchField ImagePicker" id="ImagePicker_0">
                                                            <span class="SearchFieldIcon">
																<img src="/images/pencil_16.gif" alt="" />
															</span>
                                                            <span class="SearchFieldText"></span>
                                                            <span class="SearchFieldButton">
																<img src="/images/Admin/Buttons/search.gif" alt="" />
															</span>
                                                        </a>
                                                    </div>

                                                </div>
                                            </div>
                                        </div>
                                        <div class="Field ImagePickerRender" name="ImagePickerRender_0" id="ImagePickerRender_0">
                                            <img src="">
                                        </div>
                                    </div>

                                    <div class="RowCard" id="DivRowCard_0">
                                      	<div class="tip"><em>Tip: Row Card displays with the Image displayed to the left and stacked to the right is the Title, Text and Link.</em></div>
                                      
                                        <label>Card Title: <input class="form-control required cardTitle"
												type="text"
												name="CardTitle_0" id="CardTitle_0" /></label>
                                        <label>Card Text: <input class="form-control required cardText"
												type="text"
												name="CardText_0" id="CardText_0" /></label>
                                        <label>Card Link Text: <input class="form-control required
												cardLinkText"
												type="text"
												name="cardLinkText_0" id="cardLinkText_0" /></label>
                                        <hr>
                                        <div class="Field">
                                            <p>
                                                <label>Selected Link Name:</label>
                                                <span class="selected-link-name"></span>
                                            </p>
                                            <p>
                                                <label>Selected Link URL:</label>
                                                <span class="selected-link-url"></span>
                                            </p>
                                            <p>
                                                <button class="btn-select" name="btn-select_0" id="btn-select_0">Select
													Link</button>
                                            </p>
                                        </div>
                                        <hr>
                                        <div class="Field">
                                            <div class="FieldHeading">
                                                <label for="field-highlighter-image" class="FieldLabel">Image:</label>
                                                <span class="FieldRequired">*</span>
                                                <span class="clear"></span>
                                            </div>
                                            <div class="FieldContent">
                                                <div class="SearchFieldContainer">
                                                    <div class="SearchFieldBox">
                                                        <a href="#" class="SearchField ImagePicker" id="ImagePicker_0">
                                                            <span class="SearchFieldIcon">
																<img src="/images/pencil_16.gif" alt="" />
															</span>
                                                            <span class="SearchFieldText"></span>
                                                            <span class="SearchFieldButton">
																<img src="/images/Admin/Buttons/search.gif" alt="" />
															</span>
                                                        </a>
                                                    </div>

                                                </div>
                                            </div>
                                        </div>
                                        <div class="Field ImagePickerRender" name="ImagePickerRender_0" id="ImagePickerRender_0">
                                            <img src="">
                                        </div>
                                    </div>

                                    <div class="PageTitle" id="DivPageTitle_0">
                                      	<div class="tip"><em>Tip: Page Title is used at the very top of the page under the navigation. There only needs to be one Page Title per page.</em></div>
                                      
                                        <label>Page Title: <input class="form-control required pageTitle"
												type="text"
												name="PageTitle_0" id="PageTitle_0" /></label>
                                    </div>


                                    <div class="Accordion" id="DivAccordion_0">
                                      	<div class="tip"><em>Tip: Accordion allows you to enter the text that is initially seen by the user (Accordion Text) and the content (Accordion Content) that is seen when it opens.</em></div>
                                      
                                        <label>Accordion Text: <input class="form-control required
												accordionText" type="text"
												name="AccordionText_0" id="AccordionText_0" /></label>
                                        <div class="FieldContent">
                                            <label>Accordion Content: </label>
                                            <textarea class="tinymce" id="AccordionContent_0" name="AccordionContent_0" cols="80"></textarea>
                                        </div>
                                    </div>


                                    <div class="NextFrontiers" id="DivNextFrontiers_0">
                                      	<div class="tip"><em>Tip: Text below is formatted and displayed in Call-out Box.</em></div>                                      
                                        <label>As the thriving research nexus of our region, the University of
											Cincinnati is solving problems with unrivaled talent who push the
											boundaries of discovery and innovation for the greater good. Your
											investment in Next, Now: The Campaign for Cincinnati can launch UC
											research and innovation to the next frontiers that await us.</label>
                                    </div>

                                    <div class="NextNow" id="DivNextNow_0">
                                      	<div class="tip"><em>Tip: Text below is formatted and displayed in Call-out Box.</em></div>
                                        <label>With its focus on innovation and impact, Next, Now: The
											Campaign for Cincinnati is where ambition meets action. At the
											University of Cincinnati and UC Health, we’re driven by next;
											thinking bolder and dreaming bigger to create the tomorrow we
											envision, today.<br>What’s NEXT, starts with you.</label>
                                    </div>

                                    <div class="EmpowerNext" id="DivEmpowerNext_0">
                                      	<div class="tip"><em>Tip: Text below is formatted and displayed in Call-out Box.</em></div>
                                        <label>Scholarships, fellowships and enrichment programs provide
											opportunities for students to attend, grow and graduate from UC. You
											can empower our next leaders through support for scholarships and
											signature programs in career-based education, co-op or professional
											development.</label>
                                    </div>

                                    <div class="SubFooter" id="DivSubFooter_0">
                                      	<div class="tip"><em>Tip: Sub Footer gives you the option to select a background image, Heading, Sub-Heading, Link Text and Link.</em></div>
                                      
                                        <label>Heading: <input class="form-control required subFooterHeading"
												type="text"
												name="SubFooterHeading_0" id="SubFooterHeading_0" /></label>
                                        <label>Sub-Heading: <input class="form-control subFooterSubHeading"
												type="text"
												name="SubFooterSubHeading_0" id="SubFooterSubHeading_0" /></label>
                                        <label>Call-Out Link Text: <input class="form-control required
												subfooterLinkText"
												type="text"
												name="SubfooterLinkText_0" id="SubfooterLinkText_0" /></label>
                                        <hr>
                                        <div class="Field">
                                            <p>
                                                <label>Selected Link Name:</label>
                                                <span class="selected-link-name"></span>
                                            </p>
                                            <p>
                                                <label>Selected Link URL:</label>
                                                <span class="selected-link-url"></span>
                                            </p>
                                            <p>
                                                <button class="btn-select" name="btn-select_0" id="btn-select_0">Select
													Link</button>
                                            </p>
                                        </div>
                                        <hr>
                                        <div class="Field">
                                            <div class="FieldHeading">
                                                <label for="field-highlighter-image" class="FieldLabel">Background
													Image:</label>
                                                <span class="FieldRequired">*</span>
                                                <span class="clear"></span>
                                            </div>
                                            <div class="FieldContent">
                                                <div class="SearchFieldContainer">
                                                    <div class="SearchFieldBox">
                                                        <a href="#" class="SearchField ImagePicker" id="ImagePicker_0">
                                                            <span class="SearchFieldIcon">
																<img src="/images/pencil_16.gif" alt="" />
															</span>
                                                            <span class="SearchFieldText"></span>
                                                            <span class="SearchFieldButton">
																<img src="/images/Admin/Buttons/search.gif" alt="" />
															</span>
                                                        </a>
                                                    </div>

                                                </div>
                                            </div>
                                        </div>
                                        <div class="Field ImagePickerRender" name="ImagePickerRender_0" id="ImagePickerRender_0">
                                            <img src="">
                                        </div>
                                    </div>

                                    <div class="Footer" id="DivFooter_0">
                                      	<div class="tip"><em>Tip: .</em></div>
                                        <div class="Field">
                                            <div class="FieldHeading">
                                                <label for="field-highlighter-image" class="FieldLabel">Background
													Image:</label>
                                                <span class="FieldRequired">*</span>
                                                <span class="clear"></span>
                                            </div>
                                            <div class="FieldContent">
                                                <div class="SearchFieldContainer">
                                                    <div class="SearchFieldBox">
                                                        <a href="#" class="SearchField ImagePicker" id="ImagePicker_0">
                                                            <span class="SearchFieldIcon">
																<img src="/images/pencil_16.gif" alt="" />
															</span>
                                                            <span class="SearchFieldText"></span>
                                                            <span class="SearchFieldButton">
																<img src="/images/Admin/Buttons/search.gif" alt="" />
															</span>
                                                        </a>
                                                    </div>

                                                </div>
                                            </div>
                                        </div>
                                        <div class="Field ImagePickerRender" name="ImagePickerRender_0" id="ImagePickerRender_0">
                                            <img src="">
                                        </div>

                                        <hr>
                                        <h3>First Column</h3>
                                        <label>Heading: <input class="form-control required
												footerColOneHeading" type="text"
												name="FooterColOneHeading_0" id="FooterColOneHeading_0" /></label>
                                        <hr>
                                        <h3>Second Column</h3>
                                        <label>Heading: <input class="form-control required
												footerColTwoHeading" type="text"
												name="FooterColTwoHeading_0" id="FooterColTwoHeading_0" /></label>
                                        <hr>
                                        <h3>Third Column</h3>
                                        <label>Heading: <input class="form-control required
												footerColThreeHeading" type="text"
												name="FooterColThreeHeading_0" id="FooterColThreeHeading_0" /></label>
                                    </div>


                                    <div class="MaxLength" id="DivMaxLength_0">
                                        <label>Max length: <input class="form-control" type="number" step="1"
												value="255" name="MaxLength_0" id="MaxLength_0" /></label>
                                        <span class="helper">Limited to 255</span>
                                    </div>

                                </div>

                                <div class="middle">
                                    <!--<div class="QuoteSource" id="DivQuoteSource_0">
                                        <label>Quote Source: <input class="form-control" type="text"
												name="QuoteSource_0"
												id="QuoteSource_0" /></label>
                                    </div>-->
                                    <div class="Help" id="DivHelp_0">
                                        <label>Help Text: <input class="form-control" type="text"
												name="Help_0"
												id="Help_0" /></label>
                                    </div>
                                    <div class="ColumnWidth" id="DivColumnWidth_0">
                                        <label>Columns(/12): <select class="form-control" name="ColumnWidth_0"
												id="ColumnWidth_0">
												<option>1</option>
												<option>2</option>
												<option>3</option>
												<option>4</option>
												<option>5</option>
												<option>6</option>
												<option>7</option>
												<option>8</option>
												<option>9</option>
												<option>10</option>
												<option>11</option>
												<option selected="selected">12</option>
											</select>
										</label>
                                    </div>
                                    <div class="FullPageWidth" id="DivFullPageWidth_0">
                                        <label>Full Width of Page? <select class="form-control"
												name="FullPageWidth_0"
												id="FullPageWidth_0">
												<option>No</option>
												<option>Yes</option>
											</select>
										</label>
                                    </div>
                                </div>

                                <div class="Col3">
                                    <div class="QuestionRequired" id="DivQuestionRequired_0">
                                        <label><input class="form-control" type="checkbox"
												name="QuestionRequired_0" id="QuestionRequired_0" /> Mark as
											required</label>
                                    </div>

                                    <div class="LinkAttribute" id="DivLinkAttribute_0">
                                        <label><input class="form-control" type="checkbox"
												name="LinkAttribute_0" id="LinkAttribute_0" /> Link to attribute</label>
                                        <div class="LinkAttributeExpand" style="display: none;">
                                            <label>Attribute label: <input class="form-control required"
													type="text" name="Attribute_0" id="Attribute_0" /></label><br />
                                            <span class="helper">Must match exactly what has been set up on the
												Interaction Add form</span>
                                        </div>
                                    </div>

                                    <div class="DisplayCondition" id="DivDisplayCondition_0">
                                        <label><input class="form-control" type="checkbox"
												name="DisplayCondition_0" id="DisplayCondition_0" /> Display
											conditionally</label>
                                        <div class="DisplayconditionExpand" style="display: none;">
                                            <span>Where</span>
                                            <select name="ddDisplayConditionCompare_0" id="ddDisplayConditionCompare_0">
												<option>&lt;Select a question&gt;</option>
												<option>This will be populated</option>
												<option>With a list of questions</option>
											</select>
                                            <span>is</span>
                                            <select name="ddDisplayConditionIs_0" id="ddDisplayConditionIs_0">
												<option value="equals">Equal To</option>
												<option value="not">Not Equal To</option>
											</select>
                                            <div class="FieldCompare">
                                                <input class="required" type="text" name="ddDisplayConditionValText_0" id="ddDisplayConditionValText_0" />
                                                <input type="checkbox" name="ddDisplayConditionIsCheckbox_0" id="ddDisplayConditionIsCheckbox_0" />
                                            </div>
                                        </div>
                                    </div>
                                </div>

                            </div>


                        </div>
                    </div>
                </div>

                <a class="ItemActionAdd" class="BBAdminButtonLnk" href="#">
                    <span class="BBAdminButtonContent">
						<span ass="BBAdminButtonLabel">
							<i class="fa fa-plus-circle"></i> Add Content
						</span>
                    </span>
                </a>

            </div>

        </div>

    </div>

</div>

<div id="newItem" title="Add a new Web Component">
    <label>Field type:<br />
		<select id="NewItemFieldType">
			<option disabled selected>-- Select an Option --</option>
			<optgroup label="Text Field">
				<option value="blockquote">Blockquote</option>
				<option value="formattedtext">Formatted Text</option>
				<option value="text">Text</option>
				<option value="byline">Byline</option>
			</optgroup>
			<optgroup label="Headings">
				<!--<option value="heading1">Heading 1</option>-->
				<option value="heading2">Heading 2</option>
				<option value="heading3">Heading 3</option>
				<option value="subheading">Sub-Heading</option>
			</optgroup>
			<optgroup label="Components">
				<option value="accordion">Accordion</option>
				<option value="buttonlink">Button Link</option>
				<option value="calloutbox">Call-Out Box</option>
				<option value="card">Grid Card</option>
				<option value="hr">Horizontal Rule</option>
				<option value="image">Image</option>
				<option value="rowcard">Row Card</option>
				<option value="pagetitle">Page Title</option>
				<option value="relatedstory">Related Story</option>
              	<option value="video">Video embed</option>
			</optgroup>
			<optgroup label="Footer options">
				<option value="subfooter">Sub-Footer Call-Out w/BG</option>
				<option value="footer">Footer</option>
			</optgroup>
			<optgroup label="Callout Card">
				<option value="nextfrontiers">Explore Our Next Frontiers</option>
				<option value="nextnow">NEXT, NOW</option>
				<option value="empowernext">Who will you empower NEXT?</option>
			</optgroup>
			<option value="page break">Page Break</option>
		</select>
	</label>
</div>

<!--<script src="https://cdn.tiny.cloud/1/no-api-key/tinymce/5/tinymce.min.js" type="text/javascript"></script>
<script src='https://cloud.tinymce.com/stable/tinymce.min.js?apiKey=u1z7mud98ppwucag8wv1vgvzl6uxxsth7l3qbv1go17ighu0'></script>-->
<script src="https://cdnjs.cloudflare.com/ajax/libs/tinymce/5.8.1/tinymce.min.js"></script>
<script>
    //variables etc.
    var count = 0;
    var $item = {};
    var ready = false;

    //FIELD SETTINGS
    var Fields = {};

  	Fields["video"] = {
      	"Video": true,
        "ButtonLink": false,
        "AdvancedDonationForm": false,
        "Byline": false,
        "Question": false,
        "Blockquote": false,
        "RelatedStory": false,
        "Card": false,
        "RowCard": false,
        "HR": false,
        "NextFrontiers": false,
        "NextNow": false,
        "EmpowerNext": false,
        "Image": false,
        "PageTitle": false,
        "SubFooter": false,
        "Footer": false,
        "Accordion": false,
        "CalloutBox": false,
        "Formattedtext": false,
        "QuoteSource": false,
        "Help": false,
        "QuestionRequired": false,
        "MaxLength": false,
        "LinkAttribute": false,
        "DisplayCondition": false,
        "TextFieldType": "text",
        "EventCateogry": false,
        "QAS": false,
        "ConditionFieldType": "text",
        "ColumnWidth": true,
        "FullPageWidth": false
    }
    Fields["buttonlink"] = {
      	"Video": false,
        "ButtonLink": true,
        "AdvancedDonationForm": false,
        "Byline": false,
        "Question": false,
        "Blockquote": false,
        "RelatedStory": false,
        "Card": false,
        "RowCard": false,
        "HR": false,
        "NextFrontiers": false,
        "NextNow": false,
        "EmpowerNext": false,
        "Image": false,
        "PageTitle": false,
        "SubFooter": false,
        "Footer": false,
        "Accordion": false,
        "CalloutBox": false,
        "Formattedtext": false,
        "QuoteSource": false,
        "Help": false,
        "QuestionRequired": false,
        "MaxLength": false,
        "LinkAttribute": false,
        "DisplayCondition": false,
        "TextFieldType": "text",
        "EventCateogry": false,
        "QAS": false,
        "ConditionFieldType": "text",
        "ColumnWidth": false,
        "FullPageWidth": false
    }
    Fields["blockquote"] = {
      	"Video": false,
        "ButtonLink": false,
        "AdvancedDonationForm": false,
        "Byline": false,
        "Question": false,
        "Blockquote": true,
        "RelatedStory": false,
        "Card": false,
        "RowCard": false,
        "HR": false,
        "NextFrontiers": false,
        "NextNow": false,
        "EmpowerNext": false,
        "Image": false,
        "PageTitle": false,
        "SubFooter": false,
        "Footer": false,
        "Accordion": false,
        "CalloutBox": false,
        "Formattedtext": false,
        "QuoteSource": false,
        "Help": false,
        "QuestionRequired": false,
        "MaxLength": false,
        "LinkAttribute": false,
        "DisplayCondition": false,
        "TextFieldType": "text",
        "EventCateogry": false,
        "QAS": false,
        "ConditionFieldType": "text",
        "ColumnWidth": false,
        "FullPageWidth": false
    }
    Fields["formattedtext"] = {
      	"Video": false,
        "ButtonLink": false,
        "AdvancedDonationForm": false,
        "Byline": false,
        "Question": false,
        "Blockquote": false,
        "RelatedStory": false,
        "Card": false,
        "RowCard": false,
        "HR": false,
        "NextFrontiers": false,
        "NextNow": false,
        "EmpowerNext": false,
        "Image": false,
        "PageTitle": false,
        "SubFooter": false,
        "Footer": false,
        "Accordion": false,
        "CalloutBox": false,
        "Formattedtext": true,
        "QuoteSource": false,
        "Help": false,
        "QuestionRequired": false,
        "MaxLength": false,
        "LinkAttribute": false,
        "DisplayCondition": false,
        "TextFieldType": "text",
        "EventCateogry": false,
        "QAS": false,
        "ConditionFieldType": "text",
        "ColumnWidth": true,
        "FullPageWidth": false
    }
    Fields["calloutbox"] = {
      	"Video": false,
        "ButtonLink": false,
        "AdvancedDonationForm": false,
        "Byline": false,
        "Question": false,
        "Blockquote": false,
        "RelatedStory": false,
        "Card": false,
        "RowCard": false,
        "HR": false,
        "NextFrontiers": false,
        "NextNow": false,
        "EmpowerNext": false,
        "Image": false,
        "PageTitle": false,
        "SubFooter": false,
        "Footer": false,
        "Accordion": false,
        "CalloutBox": true,
        "Formattedtext": false,
        "QuoteSource": false,
        "Help": false,
        "QuestionRequired": false,
        "MaxLength": false,
        "LinkAttribute": false,
        "DisplayCondition": false,
        "TextFieldType": "text",
        "EventCateogry": false,
        "QAS": false,
        "ConditionFieldType": "text",
        "ColumnWidth": true,
        "FullPageWidth": false
    }
    Fields["text"] = {
      	"Video": false,
        "ButtonLink": false,
        "AdvancedDonationForm": false,
        "Byline": false,
        "Question": true,
        "Blockquote": false,
        "RelatedStory": false,
        "Card": false,
        "RowCard": false,
        "HR": false,
        "NextFrontiers": false,
        "NextNow": false,
        "EmpowerNext": false,
        "Image": false,
        "PageTitle": false,
        "SubFooter": false,
        "Footer": false,
        "Accordion": false,
        "CalloutBox": false,
        "Formattedtext": false,
        "QuoteSource": false,
        "Help": false,
        "QuestionRequired": false,
        "MaxLength": false,
        "LinkAttribute": false,
        "DisplayCondition": false,
        "TextFieldType": "text",
        "EventCateogry": false,
        "QAS": false,
        "ConditionFieldType": "text",
        "ColumnWidth": true,
        "FullPageWidth": false
    }
    Fields["byline"] = {
      	"Video": false,
        "ButtonLink": false,
        "AdvancedDonationForm": false,
        "Byline": true,
        "Question": false,
        "Blockquote": false,
        "RelatedStory": false,
        "Card": false,
        "RowCard": false,
        "HR": false,
        "NextFrontiers": false,
        "NextNow": false,
        "EmpowerNext": false,
        "Image": false,
        "PageTitle": false,
        "SubFooter": false,
        "Footer": false,
        "Accordion": false,
        "CalloutBox": false,
        "Formattedtext": false,
        "QuoteSource": false,
        "Help": false,
        "QuestionRequired": false,
        "MaxLength": false,
        "LinkAttribute": false,
        "DisplayCondition": false,
        "TextFieldType": "text",
        "EventCateogry": false,
        "QAS": false,
        "ConditionFieldType": "text",
        "ColumnWidth": false,
        "FullPageWidth": false
    }

      /*
	  Fields["heading1"] = {
      	"Video": false,
        "ButtonLink": false,
        "AdvancedDonationForm": false,
        "Byline": false,
        "Question": true,
        "Blockquote": false,
        "RelatedStory": false,
        "Card": false,
        "RowCard": false,
        "HR": false,
        "NextFrontiers": false,
        "NextNow": false,
        "EmpowerNext": false,
        "Image": false,
        "PageTitle": false,
        "SubFooter": false,
        "Footer": false,
        "Accordion": false,
        "CalloutBox": false,
        "Formattedtext": false,
        "QuoteSource": false,
        "Help": false,
        "QuestionRequired": false,
        "MaxLength": false,
        "LinkAttribute": false,
        "DisplayCondition": false,
        "TextFieldType": "text",
        "EventCateogry": false,
        "QAS": false,
        "ConditionFieldType": "text",
        "ColumnWidth": false,
        "FullPageWidth": false
    } */
    Fields["heading2"] = {
      	"Video": false,
        "ButtonLink": false,
        "AdvancedDonationForm": false,
        "Byline": false,
        "Question": true,
        "Blockquote": false,
        "RelatedStory": false,
        "Card": false,
        "RowCard": false,
        "HR": false,
        "NextFrontiers": false,
        "NextNow": false,
        "EmpowerNext": false,
        "Image": false,
        "PageTitle": false,
        "SubFooter": false,
        "Footer": false,
        "Accordion": false,
        "CalloutBox": false,
        "Formattedtext": false,
        "QuoteSource": false,
        "Help": false,
        "QuestionRequired": false,
        "MaxLength": false,
        "LinkAttribute": false,
        "DisplayCondition": false,
        "TextFieldType": "text",
        "EventCateogry": false,
        "QAS": false,
        "ConditionFieldType": "text",
        "ColumnWidth": false,
        "FullPageWidth": false
    }
    Fields["heading3"] = {
      	"Video": false,
        "ButtonLink": false,
        "AdvancedDonationForm": false,
        "Byline": false,
        "Question": true,
        "Blockquote": false,
        "RelatedStory": false,
        "Card": false,
        "RowCard": false,
        "HR": false,
        "NextFrontiers": false,
        "NextNow": false,
        "EmpowerNext": false,
        "Image": false,
        "PageTitle": false,
        "SubFooter": false,
        "Footer": false,
        "Accordion": false,
        "CalloutBox": false,
        "Formattedtext": false,
        "QuoteSource": false,
        "Help": false,
        "QuestionRequired": false,
        "MaxLength": false,
        "LinkAttribute": false,
        "DisplayCondition": false,
        "TextFieldType": "text",
        "EventCateogry": false,
        "QAS": false,
        "ConditionFieldType": "text",
        "ColumnWidth": false,
        "FullPageWidth": false
    }
    Fields["subheading"] = {
      	"Video": false,
        "ButtonLink": false,
        "AdvancedDonationForm": false,
        "Byline": false,
        "Question": true,
        "Blockquote": false,
        "RelatedStory": false,
        "Card": false,
        "RowCard": false,
        "HR": false,
        "NextFrontiers": false,
        "NextNow": false,
        "EmpowerNext": false,
        "Image": false,
        "PageTitle": false,
        "SubFooter": false,
        "Footer": false,
        "Accordion": false,
        "CalloutBox": false,
        "Formattedtext": false,
        "QuoteSource": false,
        "Help": false,
        "QuestionRequired": false,
        "MaxLength": false,
        "LinkAttribute": false,
        "DisplayCondition": false,
        "TextFieldType": "text",
        "EventCateogry": false,
        "QAS": false,
        "ConditionFieldType": "text",
        "ColumnWidth": false,
        "FullPageWidth": false
    }

    Fields["accordion"] = {
      	"Video": false,
        "ButtonLink": false,
        "AdvancedDonationForm": false,
        "Byline": false,
        "Question": false,
        "Blockquote": false,
        "RelatedStory": false,
        "Card": false,
        "RowCard": false,
        "HR": false,
        "NextFrontiers": false,
        "NextNow": false,
        "EmpowerNext": false,
        "Image": false,
        "PageTitle": false,
        "SubFooter": false,
        "Footer": false,
        "Accordion": true,
        "CalloutBox": false,
        "Formattedtext": false,
        "QuoteSource": false,
        "Help": false,
        "QuestionRequired": false,
        "MaxLength": false,
        "LinkAttribute": false,
        "DisplayCondition": false,
        "TextFieldType": "text",
        "EventCateogry": false,
        "QAS": false,
        "ConditionFieldType": "text",
        "ColumnWidth": true,
        "FullPageWidth": false
    }
    Fields["relatedstory"] = {
      	"Video": false,
        "ButtonLink": false,
        "AdvancedDonationForm": false,
        "Byline": false,
        "Question": false,
        "Blockquote": false,
        "RelatedStory": true,
        "Card": false,
        "RowCard": false,
        "HR": false,
        "NextFrontiers": false,
        "NextNow": false,
        "EmpowerNext": false,
        "Image": false,
        "PageTitle": false,
        "SubFooter": false,
        "Footer": false,
        "Accordion": false,
        "CalloutBox": false,
        "Formattedtext": false,
        "QuoteSource": false,
        "Help": false,
        "QuestionRequired": false,
        "MaxLength": false,
        "LinkAttribute": false,
        "DisplayCondition": false,
        "TextFieldType": "text",
        "EventCateogry": false,
        "QAS": false,
        "ConditionFieldType": "text",
        "ColumnWidth": true,
        "FullPageWidth": false
    }
    Fields["card"] = {
      	"Video": false,
        "ButtonLink": false,
        "AdvancedDonationForm": false,
        "Byline": false,
        "Question": false,
        "Blockquote": false,
        "RelatedStory": false,
        "Card": true,
        "RowCard": false,
        "HR": false,
        "NextFrontiers": false,
        "NextNow": false,
        "EmpowerNext": false,
        "Image": false,
        "PageTitle": false,
        "SubFooter": false,
        "Footer": false,
        "Accordion": false,
        "CalloutBox": false,
        "Formattedtext": false,
        "QuoteSource": false,
        "Help": false,
        "QuestionRequired": false,
        "MaxLength": false,
        "LinkAttribute": false,
        "DisplayCondition": false,
        "TextFieldType": "text",
        "EventCateogry": false,
        "QAS": false,
        "ConditionFieldType": "text",
        "ColumnWidth": true,
        "FullPageWidth": false
    }
    Fields["rowcard"] = {
      	"Video": false,
        "ButtonLink": false,
        "AdvancedDonationForm": false,
        "Byline": false,
        "Question": false,
        "Blockquote": false,
        "RelatedStory": false,
        "Card": false,
        "RowCard": true,
        "HR": false,
        "NextFrontiers": false,
        "NextNow": false,
        "EmpowerNext": false,
        "Image": false,
        "PageTitle": false,
        "SubFooter": false,
        "Footer": false,
        "Accordion": false,
        "CalloutBox": false,
        "Formattedtext": false,
        "QuoteSource": false,
        "Help": false,
        "QuestionRequired": false,
        "MaxLength": false,
        "LinkAttribute": false,
        "DisplayCondition": false,
        "TextFieldType": "text",
        "EventCateogry": false,
        "QAS": false,
        "ConditionFieldType": "text",
        "ColumnWidth": true,
        "FullPageWidth": false
    }
    Fields["hr"] = {
      	"Video": false,
        "ButtonLink": false,
        "AdvancedDonationForm": false,
        "Byline": false,
        "Question": false,
        "Blockquote": false,
        "RelatedStory": false,
        "Card": false,
        "RowCard": false,
        "HR": true,
        "NextFrontiers": false,
        "NextNow": false,
        "EmpowerNext": false,
        "Image": false,
        "PageTitle": false,
        "SubFooter": false,
        "Footer": false,
        "Accordion": false,
        "CalloutBox": false,
        "Formattedtext": false,
        "QuoteSource": false,
        "Help": false,
        "QuestionRequired": false,
        "MaxLength": false,
        "LinkAttribute": false,
        "DisplayCondition": false,
        "TextFieldType": "text",
        "EventCateogry": false,
        "QAS": false,
        "ConditionFieldType": "text",
        "ColumnWidth": true,
        "FullPageWidth": false
    }
    Fields["image"] = {
      	"Video": false,
        "ButtonLink": false,
        "AdvancedDonationForm": false,
        "Byline": false,
        "Question": false,
        "Blockquote": false,
        "RelatedStory": false,
        "Card": false,
        "RowCard": false,
        "HR": false,
        "NextFrontiers": false,
        "NextNow": false,
        "EmpowerNext": false,
        "Image": true,
        "PageTitle": false,
        "SubFooter": false,
        "Footer": false,
        "Accordion": false,
        "CalloutBox": false,
        "Formattedtext": false,
        "QuoteSource": false,
        "Help": false,
        "QuestionRequired": false,
        "MaxLength": false,
        "LinkAttribute": false,
        "DisplayCondition": false,
        "TextFieldType": "text",
        "EventCateogry": false,
        "QAS": false,
        "ConditionFieldType": "text",
        "ColumnWidth": true,
        "FullPageWidth": true
    }
    Fields["pagetitle"] = {
      	"Video": false,
        "ButtonLink": false,
        "AdvancedDonationForm": false,
        "Byline": false,
        "Question": false,
        "Blockquote": false,
        "RelatedStory": false,
        "Card": false,
        "RowCard": false,
        "HR": false,
        "NextFrontiers": false,
        "NextNow": false,
        "EmpowerNext": false,
        "Image": false,
        "PageTitle": true,
        "SubFooter": false,
        "Footer": false,
        "Accordion": false,
        "CalloutBox": false,
        "Formattedtext": false,
        "QuoteSource": false,
        "Help": false,
        "QuestionRequired": false,
        "MaxLength": false,
        "LinkAttribute": false,
        "DisplayCondition": false,
        "TextFieldType": "text",
        "EventCateogry": false,
        "QAS": false,
        "ConditionFieldType": "text",
        "ColumnWidth": false,
        "FullPageWidth": true
    }

    Fields["subfooter"] = {
      	"Video": false,
        "ButtonLink": false,
        "AdvancedDonationForm": false,
        "Byline": false,
        "Question": false,
        "Blockquote": false,
        "RelatedStory": false,
        "Card": false,
        "RowCard": false,
        "HR": false,
        "NextFrontiers": false,
        "NextNow": false,
        "EmpowerNext": false,
        "Image": false,
        "PageTitle": false,
        "SubFooter": true,
        "Footer": false,
        "Accordion": false,
        "CalloutBox": false,
        "Formattedtext": false,
        "QuoteSource": false,
        "Help": false,
        "QuestionRequired": false,
        "MaxLength": false,
        "LinkAttribute": false,
        "DisplayCondition": false,
        "TextFieldType": "text",
        "EventCateogry": false,
        "QAS": false,
        "ConditionFieldType": "text",
        "ColumnWidth": false,
        "FullPageWidth": false
    }
    Fields["footer"] = {
      	"Video": false,
        "ButtonLink": false,
        "AdvancedDonationForm": false,
        "Byline": false,
        "Question": false,
        "Blockquote": false,
        "RelatedStory": false,
        "Card": false,
        "RowCard": false,
        "HR": false,
        "NextFrontiers": false,
        "NextNow": false,
        "EmpowerNext": false,
        "Image": false,
        "PageTitle": false,
        "SubFooter": false,
        "Footer": true,
        "Accordion": false,
        "CalloutBox": false,
        "Formattedtext": false,
        "QuoteSource": false,
        "Help": false,
        "QuestionRequired": false,
        "MaxLength": false,
        "LinkAttribute": false,
        "DisplayCondition": false,
        "TextFieldType": "text",
        "EventCateogry": false,
        "QAS": false,
        "ConditionFieldType": "text",
        "ColumnWidth": false,
        "FullPageWidth": false
    }

    Fields["nextfrontiers"] = {
      	"Video": false,
        "ButtonLink": false,
        "AdvancedDonationForm": false,
        "Byline": false,
        "Question": false,
        "Blockquote": false,
        "RelatedStory": false,
        "Card": false,
        "RowCard": false,
        "HR": false,
        "NextFrontiers": true,
        "NextNow": false,
        "EmpowerNext": false,
        "Image": false,
        "PageTitle": false,
        "SubFooter": false,
        "Footer": false,
        "Accordion": false,
        "CalloutBox": false,
        "Formattedtext": false,
        "QuoteSource": false,
        "Help": false,
        "QuestionRequired": false,
        "MaxLength": false,
        "LinkAttribute": false,
        "DisplayCondition": false,
        "TextFieldType": "text",
        "EventCateogry": false,
        "QAS": false,
        "ConditionFieldType": "text",
        "ColumnWidth": false,
        "FullPageWidth": false
    }
    Fields["nextnow"] = {
      	"Video": false,
        "ButtonLink": false,
        "AdvancedDonationForm": false,
        "Byline": false,
        "Question": false,
        "Blockquote": false,
        "RelatedStory": false,
        "Card": false,
        "RowCard": false,
        "HR": false,
        "NextFrontiers": false,
        "NextNow": true,
        "EmpowerNext": false,
        "Image": false,
        "PageTitle": false,
        "SubFooter": false,
        "Footer": false,
        "Accordion": false,
        "CalloutBox": false,
        "Formattedtext": false,
        "QuoteSource": false,
        "Help": false,
        "QuestionRequired": false,
        "MaxLength": false,
        "LinkAttribute": false,
        "DisplayCondition": false,
        "TextFieldType": "text",
        "EventCateogry": false,
        "QAS": false,
        "ConditionFieldType": "text",
        "ColumnWidth": false,
        "FullPageWidth": false
    }
    Fields["empowernext"] = {
      	"Video": false,
        "ButtonLink": false,
        "AdvancedDonationForm": false,
        "Byline": false,
        "Question": false,
        "Blockquote": false,
        "RelatedStory": false,
        "Card": false,
        "RowCard": false,
        "HR": false,
        "NextFrontiers": false,
        "NextNow": false,
        "EmpowerNext": true,
        "Image": false,
        "PageTitle": false,
        "SubFooter": false,
        "Footer": false,
        "Accordion": false,
        "CalloutBox": false,
        "Formattedtext": false,
        "QuoteSource": false,
        "Help": false,
        "QuestionRequired": false,
        "MaxLength": false,
        "LinkAttribute": false,
        "DisplayCondition": false,
        "TextFieldType": "text",
        "EventCateogry": false,
        "QAS": false,
        "ConditionFieldType": "text",
        "ColumnWidth": false,
        "FullPageWidth": false
    }

    Fields["page break"] = {
      	"Video": false,
        "ButtonLink": false,
        "AdvancedDonationForm": false,
        "Byline": false,
        "Question": false,
        "Blockquote": false,
        "RelatedStory": false,
        "Card": false,
        "RowCard": false,
        "HR": false,
        "NextFrontiers": false,
        "NextNow": false,
        "EmpowerNext": false,
        "Image": false,
        "PageTitle": false,
        "SubFooter": false,
        "Footer": false,
        "Accordion": false,
        "CalloutBox": false,
        "Formattedtext": false,
        "QuoteSource": false,
        "Help": false,
        "QuestionRequired": false,
        "MaxLength": false,
        "LinkAttribute": false,
        "DisplayCondition": false,
        "TextFieldType": false,
        "EventCateogry": false,
        "QAS": false,
        "ConditionFieldType": null,
        "ColumnWidth": false,
        "FullPageWidth": false
    }
    var ConditionFieldType = {};
    ConditionFieldType["text"] = {
        "ddDisplayConditionValText": true,
        "ddDisplayConditionIsCheckbox": false,
        "ddDisplayConditionCodeTable": false,
        "ddDisplayConditionEventCategory": false
    }
    ConditionFieldType["checkbox"] = {
        "ddDisplayConditionValText": false,
        "ddDisplayConditionIsCheckbox": true,
        "ddDisplayConditionCodeTable": false,
        "ddDisplayConditionEventCategory": false
    }

    $item.Row = {};
    $item.Container = {};
    $item.Table = {};
    $item.Row = $('#ItemRowTemplate').clone();
    $item.Container = $('.ItemContainer');
    $item.Table = $('.ItemTable');

    $('#ItemRowTemplate').remove();

    //loop through saved settings, and set text fields, select lists, textareas, and checkboxes (NB: not currently updating radio buttons as none have been required yet)
    $(document).ready(function() {

        //$('#ddCountries').val(BLACKBAUD.api.customPartEditor.settings["ddCountries"]);
        //$('#ddCountries').multiSelect()

        //load Event Categories

        $.get("/WebAPI/CodeTable/b328e14b-9269-4b6c-bf93-7b10c70f71c3", function(data) {
            $('#ddEventCategories').empty();
            $.each(data, function() {
                $('#ddEventCategories').append('<option value="' + this.Id + '">' + this.Description + '</option>');
            });
            $.each(BLACKBAUD.api.customPartEditor.settings["ddEventCategories"], function(key, value) {
                $('#ddEventCategories').find('option[value="' + key + '"]').prop('selected', true);
            });

            $('#ddEventCategories').multiSelect();
            ready = true;
        });

        $.each(BLACKBAUD.api.customPartEditor.settings, function(key, value) {
            if (key.substr(0, 3) === "chk" && value === "on") {
                $('#' + key).prop('checked', true).parents('table').first().addClass('CheckboxOptionSelected');
            } else {
                $('#' + key).val(value);
            }
        });

      	var CheckReady = setInterval(function() {
            if (ready) {
                $.each(BLACKBAUD.api.customPartEditor.settings["items"], function(i) {
                    addRow(BLACKBAUD.api.customPartEditor.settings["items"][i]);
                });
              	$('.Col3 label input[type="checkbox"]:checked').closest('div').addClass('open');
                ready = false;
                clearInterval(CheckReady);
            }
        }, 0);	// 100

        // BuildConditionalSelects();
        // $('select[id^=ddDisplayConditionCompare]').each(BuildConditionCompare);
        BuildMatrix();

    });

    Sys.Application.add_load(function() {
        $('form').validate({
            ignore: ":not(:visible)"
        });
    });

    //run this when it saves (hint: return false to cancel the save)
    BLACKBAUD.api.customPartEditor.onSave = function() {
        tinyMCE.triggerSave();

        if ($('form').valid()) {
            var items = [];

            $('#BBTabs input[type="checkbox"], #BBTabs input[type="radio"]').each(function() {
                var checked = $(this).is(':checked');
                if (!checked) {
                    $(this).val("off");
                } else {
                    $(this).val("on");
                }
            });

            $item.Table.find('.ItemRow').each(function(i) {
                //var tinyVal = tinyMCE.get('AccordionContent_' + i).getContent();

                var rowdata = {
                    type: $(this).attr('data-type'),
                    question: $(this).find('.Question input').val(),
                  
                  	video: $(this).find('.Video input.videoUrl').val(),
                  	videoLinkText: $(this).find('.Video input.linkText').val(),

                    quoteText: $(this).find('.Blockquote .tinymce').val(),
                  	quoteSource: $(this).find('.Blockquote input.quoteSource').val(),
                  // quoteText: $(this).find('.Blockquote input.quoteText').val(),

                    calloutText: $(this).find('.CalloutBox .tinymce').val(),

                    buttonLinkName: $(this).find('.ButtonLink .selected-link-name').text(),
                    buttonLinkUrl: $(this).find('.ButtonLink .selected-link-url').text(),
                    buttonLinkText: $(this).find('.ButtonLink input.linkText').val(),

                    relatedStoryTitle: $(this).find('.RelatedStory input.relatedStoryTitle').val(),
                    relatedStoryLinkName: $(this).find('.RelatedStory .selected-link-name').text(),
                    relatedStoryLinkUrl: $(this).find('.RelatedStory .selected-link-url').text(),
                    relatedStoryLinkText: $(this).find('.RelatedStory input.relatedStoryLinkText').val(),
                    relatedStoryImgText: $(this).find('.RelatedStory .Field .SearchFieldText').text(),
                    relatedStoryImgSrc: $(this).find('.RelatedStory .Field.ImagePickerRender img').attr('src'),

                    cardTitle: $(this).find('.Card input.cardTitle').val(),
                    cardText: $(this).find('.Card input.cardText').val(),
                    cardLinkName: $(this).find('.Card .selected-link-name').text(),
                    cardLinkUrl: $(this).find('.Card .selected-link-url').text(),
                    cardLinkText: $(this).find('.Card input.cardLinkText').val(),
                    cardImgText: $(this).find('.Card .Field .SearchFieldText').text(),
                    cardImgSrc: $(this).find('.Card .Field.ImagePickerRender img').attr('src'),

                    rowCardTitle: $(this).find('.RowCard input.cardTitle').val(),
                    rowCardText: $(this).find('.RowCard input.cardText').val(),
                    rowCardLinkName: $(this).find('.RowCard .selected-link-name').text(),
                    rowCardLinkUrl: $(this).find('.RowCard .selected-link-url').text(),
                    rowCardLinkText: $(this).find('.RowCard input.cardLinkText').val(),
                    rowCardImgText: $(this).find('.RowCard .Field .SearchFieldText').text(),
                    rowCardImgSrc: $(this).find('.RowCard .Field.ImagePickerRender img').attr('src'),

                    subFooterHeading: $(this).find('.SubFooter input.subFooterHeading').val(),
                    subFooterSubHeading: $(this).find('.SubFooter input.subFooterSubHeading').val(),
                    subFooterLinkName: $(this).find('.SubFooter .selected-link-name').text(),
                    subFooterLinkUrl: $(this).find('.SubFooter .selected-link-url').text(),
                    subfooterLinkText: $(this).find('.SubFooter input.subfooterLinkText').val(),
                    subFooterImgText: $(this).find('.SubFooter .Field .SearchFieldText').text(),
                    subFooterImgSrc: $(this).find('.SubFooter .Field.ImagePickerRender img').attr('src'),

                    footerImgText: $(this).find('.Footer .Field .SearchFieldText').text(),
                    footerImgSrc: $(this).find('.Footer .Field.ImagePickerRender img').attr('src'),
                    footerColOneHeading: $(this).find('.Footer .footerColOneHeading').val(),
                    footerColTwoHeading: $(this).find('.Footer .footerColTwoHeading').val(),
                    footerColThreeHeading: $(this).find('.Footer .footerColThreeHeading').val(),

                    imageCaption: $(this).find('.Image input.imageCaption').val(),
                    imageText: $(this).find('.Image .Field .SearchFieldText').text(),
                    imageSrc: $(this).find('.Image .Field.ImagePickerRender img').attr('src'),
                    imageAlign: $(this).find('.Image select.imageAlign').val(),

                    pageTitle: $(this).find('.PageTitle input').val(),

                    accordionText: $(this).find('.Accordion input.accordionText').val(),
                    accordionContent: $(this).find('.Accordion .tinymce').val(),

                    formattedText: $(this).find('.Formattedtext .tinymce').val(),

                    authorName: $(this).find('.Byline input.authorName').val(),
                    authorEmail: $(this).find('.Byline input.authorEmail').val(),
                    datePublished: $(this).find('.Byline input.datePublished').val(),
                    storyLinkName: $(this).find('.Byline .selected-link-name').text(),
                    storyLinkUrl: $(this).find('.Byline .selected-link-url').text(),

                    help: $(this).find('.Help input').val(),
                    columns: $(this).find('.ColumnWidth select').val(),
                    fullPageWidth: $(this).find('.FullPageWidth select').val(),
                    required: $(this).find('.QuestionRequired input').val(),
                    maxLength: $(this).find('.MaxLength input').val(),

                    linkAttr: $(this).find('.LinkAttribute input[type="checkbox"]').val(),
                    linkAttrLabel: $(this).find('.LinkAttribute input[type="text"]').val(),
                    conditional: $(this).find('.DisplayCondition label input').val(),
                    conditionalOperator: $(this).find('.DisplayCondition select[id^=ddDisplayConditionIs]').val(),
                    conditionalCompare: $(this).find('.DisplayCondition select[id^=ddDisplayConditionCompare]').val(),
                    conditionalFields: {
                        textfield: $(this).find('.DisplayCondition input[id^=ddDisplayConditionValText]').val(),
                        checkbox: $(this).find('.DisplayCondition input[id^=ddDisplayConditionIsCheckbox]').val()
                    },
                    index: $(this).find('input[id^=ItemIndex]').val()

                };
                items.push(rowdata);

            });

            // var EventCategories = {};
            //$('#ddEventCategories option:selected').each(function() {
            //     EventCategories[$(this).val()] = $(this).text();
            //});

            BLACKBAUD.api.customPartEditor.settings["items"] = items;
            // BLACKBAUD.api.customPartEditor.settings["ddEventCategories"] = EventCategories; //$('#ddEventCategories').val();
            BLACKBAUD.api.customPartEditor.settings["ddCountries"] = $('#ddCountries').val();
            BLACKBAUD.api.customPartEditor.settings["txtShow"] = $('#txtShow').val();
            BLACKBAUD.api.customPartEditor.settings["txtLimit"] = $('#txtLimit').val();
            BLACKBAUD.api.customPartEditor.settings["txtAPI"] = $('#txtAPI').val();
            BLACKBAUD.api.customPartEditor.settings["txtButtonNext"] = $('#txtButtonNext').val();
            BLACKBAUD.api.customPartEditor.settings["txtButtonPrev"] = $('#txtButtonPrev').val();

            return true;

        } else {
            return false;
        }

    };

    //trigger on checkbox change to set the value properly... there's a bug in chrome that sets the checkbox value to 'on' even when it's been unchecked.
    $(document).on('change', '#BBTabs input[type="checkbox"], #BBTabs input[type="radio"]', function() {
        var checked = $(this).is(':checked');
        if (!checked) {
            $(this).val("off");
        } else {
            $(this).val("on");
        }
    });

    // Return a helper with preserved width of cells
    var fixHelper = function(e, ui) {
        ui.children().each(function(i) {
            $(this).width($(this).width());
        });
        return ui;
    };

    $item.Table.sortable({
        handle: '.ItemActionMove',
      	placeholder: 'ui-state-highlight',
        cursor: 'move',
        helper: fixHelper,
        update: function(event, ui) {
            $item.Table.find('.ItemRow').each(function(i) {
                $(this).find(".Counter span").text(i + 1);
            });

            // BuildConditionalSelects();
            BuildMatrix();
        }
    });

    //functions
    function addRow(item) {

        var $newRow = $item.Row.clone();
        var count = GetID();

        if (item !== undefined) {
            count = item.index;
        }

        $newRow.find('div, select, input, a, button, textarea, button').each(function() {
            var ID = $(this).attr('id');
            var name = $(this).attr('name');

            if (ID !== undefined) {
                var newID = ID.replace("_0", "_" + count);
                $(this).attr('id', newID);
            }
            if (name !== undefined) {
                var newName = name.replace("_0", "_" + count);
                if ($(this).attr('type') != "radio") {
                    $(this).attr('name', newName);
                } else {
                    $(this).attr('name', 'item_' + name);
                }
            }
        });

        // tinymce.EditorManager.execCommand('mceAddEditor', true, 'textarea.tinymce');

        // $newRow.find('select[id^=ddDisplayConditionEventCategory]').append($('#ddEventCategories option:selected').clone());

        if (item !== undefined) {
          	console.log(item);

            $newRow.find('.Question input').val(item.question);
          
          	$newRow.find('.Video input.videoUrl').val(item.video);
          	$newRow.find('.Video input.linkText').val(item.videoLinkText);

          // $newRow.find('.Blockquote input.quoteText').val(item.quoteText);
          	$newRow.find('.Blockquote .tinymce').val(item.quoteText);
            $newRow.find('.Blockquote input.quoteSource').val(item.quoteSource);

            $newRow.find('.CalloutBox .tinymce').val(item.calloutText);

            $newRow.find('.ButtonLink .selected-link-name').text(item.buttonLinkName);
            $newRow.find('.ButtonLink .selected-link-url').text(item.buttonLinkUrl);
            $newRow.find('.ButtonLink .linkText').val(item.buttonLinkText);

            $newRow.find('.RelatedStory input.relatedStoryTitle').val(item.relatedStoryTitle);
            $newRow.find('.RelatedStory .selected-link-name').text(item.relatedStoryLinkName);
            $newRow.find('.RelatedStory .selected-link-url').text(item.relatedStoryLinkUrl);
            $newRow.find('.RelatedStory .relatedStoryLinkText').val(item.relatedStoryLinkText);
            $newRow.find('.RelatedStory .Field .SearchFieldText').text(item.relatedStoryImgText);
            $newRow.find('.RelatedStory .SearchField.ImagePicker').attr('id', 'ImagePicker_' + item.index);
            $newRow.find('.RelatedStory .Field.ImagePickerRender img').attr('src', item.relatedStoryImgSrc);

            $newRow.find('.Card input.cardTitle').val(item.cardTitle);
            $newRow.find('.Card input.cardText').val(item.cardText);
            $newRow.find('.Card .selected-link-name').text(item.cardLinkName);
            $newRow.find('.Card .selected-link-url').text(item.cardLinkUrl);
            $newRow.find('.Card .cardLinkText').val(item.cardLinkText);
            $newRow.find('.Card .Field .SearchFieldText').text(item.cardImgText);
            $newRow.find('.Card .SearchField.ImagePicker').attr('id', 'ImagePicker_' + item.index);
            $newRow.find('.Card .Field.ImagePickerRender img').attr('src', item.cardImgSrc);

            $newRow.find('.RowCard input.cardTitle').val(item.rowCardTitle);
            $newRow.find('.RowCard input.cardText').val(item.rowCardText);
            $newRow.find('.RowCard .selected-link-name').text(item.rowCardLinkName);
            $newRow.find('.RowCard .selected-link-url').text(item.rowCardLinkUrl);
            $newRow.find('.RowCard .cardLinkText').val(item.rowCardLinkText);
            $newRow.find('.RowCard .Field .SearchFieldText').text(item.rowCardImgText);
            $newRow.find('.RowCard .SearchField.ImagePicker').attr('id', 'ImagePicker_' + item.index);
            $newRow.find('.RowCard .Field.ImagePickerRender img').attr('src', item.rowCardImgSrc);

            $newRow.find('.SubFooter input.subFooterHeading').val(item.subFooterHeading);
            $newRow.find('.SubFooter input.subFooterSubHeading').val(item.subFooterSubHeading);
            $newRow.find('.SubFooter .selected-link-name').text(item.subFooterLinkName);
            $newRow.find('.SubFooter .selected-link-url').text(item.subFooterLinkUrl);
            $newRow.find('.SubFooter .subfooterLinkText').val(item.subfooterLinkText);
            $newRow.find('.SubFooter .Field .SearchFieldText').text(item.subFooterImgText);
            $newRow.find('.SubFooter .SearchField.ImagePicker').attr('id', 'ImagePicker_' + item.index);
            $newRow.find('.SubFooter .Field.ImagePickerRender img').attr('src', item.subFooterImgSrc);

            $newRow.find('.Footer .Field .SearchFieldText').text(item.footerImgText);
            $newRow.find('.Footer .SearchField.ImagePicker').attr('id', 'ImagePicker_' + item.index);
            $newRow.find('.Footer .Field.ImagePickerRender img').attr('src', item.footerImgSrc);
            $newRow.find('.Footer input.footerColOneHeading').val(item.footerColOneHeading);

            $newRow.find('.Image input.imageCaption').val(item.imageCaption);
            $newRow.find('.Image .Field .SearchFieldText').text(item.imageText);
            $newRow.find('.Image .SearchField.ImagePicker').attr('id', 'ImagePicker_' + item.index);
            $newRow.find('.Image .Field.ImagePickerRender img').attr('src', item.imageSrc);
            $newRow.find('.Image select.imageAlign').val(item.imageAlign);

            $newRow.find('.PageTitle input').val(item.pageTitle);

            $newRow.find('.Accordion input.accordionText').val(item.accordionText);
            $newRow.find('.Accordion .tinymce').val(item.accordionContent);

            $newRow.find('.Formattedtext .tinymce').val(item.formattedText);

            $newRow.find('.Byline input.authorName').val(item.authorName);
            $newRow.find('.Byline input.authorEmail').val(item.authorEmail);
            $newRow.find('.Byline input.datePublished').val(item.datePublished);
            $newRow.find('.Byline .selected-link-name').text(item.storyLinkName);
            $newRow.find('.Byline .selected-link-url').text(item.storyLinkUrl);

            var tinymceId = $newRow.find('.tinymce').attr('id');
            tinymce.EditorManager.execCommand('mceAddEditor', true, '#' + tinymceId);

            $newRow.find('.QuestionRequired input').prop('checked', item.required == "on");
            $newRow.find('.Help input').val(item.help);
            $newRow.find('.ColumnWidth select').val(item.columns);
            $newRow.find('.FullPageWidth select').val(item.fullPageWidth);
            $newRow.find('.LinkAttribute input[type="checkbox"]').prop('checked', item.linkAttr == "on");
            $newRow.find('.LinkAttribute input[type="text"]').val(item.linkAttrLabel);
            $newRow.find('.MaxLength input').val(item.maxLength);
            $newRow.find('.CodeTable input').val(item.codeTableID);
            $newRow.find('.CodeTableMulti input').prop('checked', item.codeTableMulti == "on");
            $newRow.find('.DisplayCondition label input[type="checkbox"]').prop('checked', item.conditional == "on");
            $newRow.find('.DisplayCondition select[id^=ddDisplayConditionIs]').val(item.conditionalOperator);
            $newRow.find('.DisplayCondition select[id^=ddDisplayConditionCompare]').attr('data-value', item.conditionalCompare);
            $newRow.find('.DisplayCondition input[id^=ddDisplayConditionValText]').val(item.conditionalFields.textfield);
            $newRow.find('.DisplayCondition input[id^=ddDisplayConditionIsCheckbox]').prop('checked', item.conditional == "on");
            /*
          	$newRow.find('.DisplayCondition select[id^=ddDisplayConditionCodeTable]').attr('data-value', item.conditionalFields.codetable);
            $newRow.find('.DisplayCondition input[id^=ddDisplayConditionEventCategory]').val(item.conditionalFields.eventcategory);
            if (item.AddressMap) {
                $newRow.find('.AddressMap_Address select').attr('data-value', item.AddressMap.Address);
                $newRow.find('.AddressMap_Suburb select').attr('data-value', item.AddressMap.Suburb);
                $newRow.find('.AddressMap_State select').attr('data-value', item.AddressMap.State);
                $newRow.find('.AddressMap_Postcode select').attr('data-value', item.AddressMap.Postcode);
            }
            $newRow.find('.Country input').val(item.countryID);
		  */
            $newRow.attr('data-type', item.type);
            $newRow.find('.FieldType').text(item.type);
            $newRow.find('input[id^=ItemIndex]').val(item.index);
        } else {
            $newRow.find('input[id^=ItemIndex]').val(count);
            $newRow.attr('data-type', $('#NewItemFieldType').val());
            $newRow.find('.FieldType').text($('#NewItemFieldType').val());
        }

        $newRow.find('.LinkAttributeExpand, .DisplayconditionExpand').slideUp(0);
        if ($newRow.find('.LinkAttribute input[type="checkbox"]').is(':checked')) {
            $newRow.find('.LinkAttributeExpand').slideDown(150);
        }
        if ($newRow.find('.DisplayCondition input[type="checkbox"]').is(':checked')) {
            $newRow.find('.DisplayconditionExpand').slideDown(150);
        }

        $.each(Fields[$newRow.attr('data-type')], function(key, value) {
            if (!value) {
                $newRow.find("." + key).remove();
            }
        });

        $item.Table.append($newRow);

        $item.Table.find('.ItemRow').each(function(i) {
            $(this).find(".Counter span").text(i + 1);
        });

        function applyMCE() {
            tinyMCE.init({
                mode: "textareas",
                editor_selector: "tinymce",

                file_picker_types: "file image media",
                file_picker_callback: function(callback, value, meta) {
                    // Provide image and alt text for the image dialog
                    if (meta.filetype == "image") {
                        BLACKBAUD.api.customPartEditor.images.launchImagePicker({
                            callback: function(selectedImage) {
                                callback(selectedImage.url, {
                                    alt: selectedImage.alt
                                });
                            }
                        });
                    }

                    if (meta.filetype == "file") {
                        BLACKBAUD.api.customPartEditor.links.launchLinkPicker({
                            callback: function(selectedLink) {
                                callback(selectedLink.url, {
                                    text: selectedLink.name
                                });
                            }
                        });
                    }
                },
                plugins: 'code print preview searchreplace autolink directionality visualchars fullscreen image link media codesample table charmap hr pagebreak nonbreaking anchor insertdatetime advlist lists wordcount imagetools  textpattern help',
                toolbar1: 'formatselect | bold italic strikethrough forecolor backcolor | image | link | alignleft aligncenter alignright alignjustify  | numlist bullist outdent indent  | removeformat',
                image_advtab: true,
                content_css: [
                    "https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css",
                    //"/file/css/bootstrap.css",
                    "/file/css/template.css"
                ]
            });
        }

        applyMCE();

        $(function() {
            $(".datePublished").datepicker({
                dateFormat: "MM d, yy"
            });
        });

        // BuildConditionalSelects();
        BuildMatrix();
        $newRow.find('.DisplayCondition select[id^=ddDisplayConditionCompare]').change();
        // $newRow.find('.CodeTableMulti input').change();
        $newItem.dialog("close");
    }

    /* function BuildConditionalSelects() {
        $('.ItemRow').find('.DisplayCondition select[id^=ddDisplayConditionCompare]').empty().append($('<option>&lt;Select a question&gt;</option>'));

        $('.ItemRow').not('[data-type="page break"]').each(function(i) {

            if ($(this).attr('data-type') == "code table" && $(this).find('.CodeTableMulti input').is(':checked')) {
                return;
            }

            var ID = $(this).find('input[id^=ItemIndex]').val();
            var Question = $(this).find('.Question input').val();
            var counter = $(this).find('.Counter').text().trim();

            $('.ItemRow').find('.DisplayCondition select[id^=ddDisplayConditionCompare]').each(function() {
                $(this).append($('<option></option>').text(counter + ". " + Question).val(ID));
                $(this).filter('[data-value]').val($(this).attr('data-value'));
            });
        });
    } */

    $(document).on('change', '.DisplayCondition select[id^=ddDisplayConditionCompare], .DisplayCondition select[id^=ddDisplayConditionCodeTable]', function() {
        $(this).attr('data-value', $(this).val());
    });

    //action links

    // BBIS URL link
    $(document).on('click', '.btn-select', function(e) {
        e.preventDefault();

        // Verify the user has permission to launch the link picker
        if (!BLACKBAUD.api.customPartEditor.links.canLaunchLinkPicker) {
            alert('You do not have permission to launch the link picker.');
        } else {
            // Launch the link picker, passing in our callback
            var thisIdVal = $(this).parents('.Field').parent().attr('id'),
                thisSplitId = thisIdVal.split("_")[1];
            console.log(thisIdVal);

            BLACKBAUD.api.customPartEditor.links.launchLinkPicker({
                callback: function(selectedLink) {
                    $('#' + thisIdVal + ' .selected-link-name').text(selectedLink.name);
                    $('#' + thisIdVal + ' .selected-link-url').text(selectedLink.url);
                }
            });
        }
    });


    $(document).on('click', 'a.ImagePicker', function(e) {
        e.preventDefault();

        if (!BLACKBAUD.api.customPartEditor.images.canLaunchImagePicker) {
            // do nothing
        } else {
            var thisIdVal = $(this).parents('.Field').parent().attr('id'),
                thisSplitId = thisIdVal.split("_")[1];
            console.log(thisIdVal);

            BLACKBAUD.api.customPartEditor.images.launchImagePicker({
                callback: function(selectedImage) {
                    console.log(selectedImage.url);
                    $('#' + thisIdVal + ' .ImagePickerRender img').attr('src', selectedImage.url);
                    $('#' + thisIdVal + ' .ImagePicker .SearchFieldText').text(selectedImage.name);
                }
            });
        }
    });

    $(document).on('click', '.ItemActionAdd', function(e) {
        e.preventDefault();
        $("#NewItemFieldType").prop("selectedIndex", 0);
        $newItem.dialog("open");
    });

    $(document).on('click', '.ItemActionDelete', function(e) {
        e.preventDefault();
        if (confirm("This will remove this question.  Are you sure?")) {
            $(this).parents('.ItemRow').remove();
            $('.ItemRow').each(function(i) {
                $(this).find(".Counter span").text(i + 1);
            });
        }

        // BuildConditionalSelects();
        BuildMatrix();
    });

    //make a string safe for a css class (for filtering categories)
    function makeSafeForCSS(name) {
        return name.replace(/[^a-z0-9]/g, function(s) {
            var c = s.charCodeAt(0);
            if (c == 32) return '-';
            if (c >= 65 && c <= 90) return '_' + s.toLowerCase();
            return '__' + ('000' + c.toString(16)).slice(-4);
        });
    }

    $('#BBTabs').tabs();

    function GetID() {
        var maximum = 0;
        $('.ItemRow').each(function() {
            var value = parseFloat($(this).find('input[id^=ItemIndex]').val());
            maximum = (value > maximum) ? value : maximum;
        });
        return maximum + 1;
    }


    $newItem = $("#newItem").dialog({
        autoOpen: false,
        height: 200,
        width: 320,
        modal: true,
        buttons: {
            "Add": function() {
                addRow();
            },
            Cancel: function() {
                $newItem.dialog("close");
            }
        }
    });

    $(document).on('click', '.LinkAttribute label input[type="checkbox"], .DisplayCondition label input[type="checkbox"]', function() {
        $(this).parent().next().slideToggle(150);
    });
    // $(document).on('change', '.Question input', BuildConditionalSelects);
    $(document).on('change', '.Question input', BuildMatrix);

    /*
	$(document).on('change', 'select[id^=ddDisplayConditionCompare]', BuildConditionCompare);

    function BuildConditionCompare() {
        var $FieldCompare = $(this).parent().find('.FieldCompare');
        var target = $(this).val();
        if ($(this).val() !== null && $(this).val() !== "<Select a question>") {
            $.each(ConditionFieldType[Fields[$("#ItemIndex_" + $(this).val()).parent().attr('data-type')].ConditionFieldType], function(key, value) {
                var $Field = $FieldCompare.find('[id^="' + key + '"]');
                if (value) {
                    $Field.show();
                    //load Event Categories
                    if (key == "ddDisplayConditionCodeTable") {

                        $.get("/WebAPI/CodeTable/" + $('#CodeTable_' + target).val(), function(data) {
                            $Field.empty();
                            $.each(data, function() {
                                $Field.append('<option value="' + this.Id + '">' + this.Description + '</option>');
                            });
                            $Field.val($Field.attr('data-value'));
                        });
                    }

                } else {
                    $FieldCompare.find('[id^="' + key + '"]').hide().val("").prop('checked', false);
                }
            });
        } else {
            $FieldCompare.children().hide().val("").prop("checked", false);
        }
    }
	*/

    $(document).on('click', '.Col3 label input[type="checkbox"]', function() {
        if ($(this).is(':checked')) {
            $(this).closest('div').addClass('open');
        } else {
            $(this).closest('div').removeClass('open');
        }
    });
    /* $(document).on('change', '.CodeTableMulti input', function() {
        if ($(this).is(':checked')) {
            $(this).parents('.ItemRow').find('.LinkAttribute input, .QuestionRequired input').prop('checked', false).trigger('change').parents('.LinkAttribute, .QuestionRequired').removeClass('open').hide();
        } else {
            $(this).parents('.ItemRow').find('.LinkAttribute input, .QuestionRequired input').parents('.LinkAttribute, .QuestionRequired').show();
        }
    }); */
    $(document).on('click', '.header-cell a.all', function() {
        var ix = $(this).parent().index();
        $('.flexgrid section .body-row').each(function() {
            $(this).children().eq(ix).find('input').prop('checked', true);
        });
    });
    $(document).on('click', '.header-cell a.none', function() {
        var ix = $(this).parent().index();
        $('.flexgrid section .body-row').each(function() {
            $(this).children().eq(ix).find('input').prop('checked', false);
        });
    });
    $(document).on('change', '.flexgrid input[type="checkbox"]', function() {
        BLACKBAUD.api.customPartEditor.settings["Matrix"] = GetMatrixResults();
    });

    function GetMatrixResults() {
        var MatrixResults = {};
        $('.flexgrid .header-cell[data-value]').each(function() {
            var eventID = $(this).attr('data-value');
            MatrixResults[eventID] = {};
            $('.flexgrid .body-row').each(function() {
                var V = $(this).find('input[data-id="' + eventID + '"]').is(':checked');
                var Q = $(this).attr('data-index');
                MatrixResults[eventID][Q] = V;
            });
        });
        return MatrixResults;
    }


    function BuildMatrix() {
        var $SelectedEvents = $('#ddEventCategories option:selected');
        var $Questions = $('.ItemRow').not('[data-type="page break"]');
        var $header = $('.flexgrid header');
        var $body = $('.flexgrid section');
        BLACKBAUD.api.customPartEditor.settings.Matrix = BLACKBAUD.api.customPartEditor.settings.Matrix || {};

        $body.empty();
        $header.empty().append('<div class="spacer"></div>');

        $SelectedEvents.each(function() {
            $header.append($('<div class="header-cell"></div>').text($(this).text()).attr('data-value', $(this).val()).append("<br /><a class='all' href='#' style='text-decoration: none;'>(all)</a> <a class='none' href='#' style='text-decoration: none;'>(none)</a>"));
        });
        $Questions.each(function(i) {
            var QuestionID = $(this).find('[id^=ItemIndex]').val();
            var DataType = $(this).attr('data-type');
            var $row = $('<div class="body-row"></div>').attr('data-index', QuestionID);
            $row.append($('<div class="body-header-cell"></div>').text((i + 1) + ". " + $(this).find('.Question input').val()).append(' <span>[' + DataType + ']</span>'));
            $SelectedEvents.each(function() {
                var EventID = $(this).val();
                var Disabled = false;
                var IsChecked = false;
                if (typeof BLACKBAUD.api.customPartEditor.settings.Matrix[EventID] !== 'undefined') {
                    if (typeof BLACKBAUD.api.customPartEditor.settings.Matrix[EventID][QuestionID] !== 'undefined') {
                        IsChecked = BLACKBAUD.api.customPartEditor.settings.Matrix[EventID][QuestionID];
                    }
                }
                if (DataType == "event category") {
                    IsChecked = true;
                    Disabled = true;
                }
                $row.append($('<div class="body-cell"></div>').append($('<input type="checkbox" />').prop('checked', IsChecked).prop('disabled', Disabled).attr('data-id', EventID)));
            });
            $body.append($row)
        });
    }

    $(document).on('change', '.AddressMap div[data-map] select', function() {
        $(this).attr('data-value', $(this).val());
    });
</script>
